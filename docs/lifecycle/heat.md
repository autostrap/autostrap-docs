![](figures/overview-bootstrap1.svg)

Once a machine is up, cloud-init will execute the user-data script generated by
[AS::autostrap][heat::autostrap]. This
script will install [git][ext::git], copy the deploy key to /root/.ssh, and clone
[bootstrap-scripts][src::bootstrap-scripts]. Once
`bootstrap-scripts` is available, the user-data scripts will execute the
`initialize_instance` script in that repository's top-level directory, ushering
in the second bootstrapping stage.
Deployment of a service stack is kicked off by a Heat template. The schematic
below shows the key components of the
[nginx-master-agent][ex::nginx-master-agent]
example Heat template and their relation to each other:

![](figures/heat.svg)

There are two kinds of configuration the heat template passes to the two
instances (`puppetmaster` and `nginx-server`):

1. A user-data script. This script is generated by the
  [AS::autostrap][heat::autostrap] Heat
  resource and commonly parametrized through Heat. At a minimum, it needs a
  `config_repo` parameter pointing at your [project-config](/glossary/#project-config) repository.
  Commonly there is only one `AS::autostrap` resource that is passed to all servers in the stack.

1. [cloud-init][ext::cloudinit] metadata keys that pass
information for use inside the node and control various aspects of puppet
configuration. The most important such parameter is `topics`. This
parameter governs the topics from [global-config][src::global-config] that the
[second bootstrapping stage's puppet run](/lifecycle/#s2-run_puppet_hiera)
will deploy on the machine in question. In the example this makes
`puppetmaster` a puppet master and agent, and `nginx-server` a puppet agent.

Once the Heat template is finished it can be deployed with a command that might
look roughly as follows:

```
heat stack-create -f nginx-master-agent.yaml \
                  -P config_repo=git@gitlab.example.com/my_project_config.git \
                  -P key_name=mykey \
                  -P deploy_key="$(cat ~/.ssh/deploy_key)" \
                  nginx-master-agent
```

Once this command is issued, heat will create the stack's constituent
resources. As machines come up, their [AS::autostrap][heat::autostrap]
generated user-data script will be run by cloud-init. To provide an overview of the bootstrapping
process we will use the following schematic throughout the rest of this
section, with the current step highlighted:

![](figures/overview.svg)
